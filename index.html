<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ”„ ê²½ì œ ìƒí™©íŒ (ì¬ì‹œì‘ ë²„ì „)</title>
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: -apple-system, sans-serif; padding: 15px; margin: 0; }
        .header { text-align: center; font-size: 1.1rem; font-weight: bold; margin-bottom: 25px; color: #c5a059; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .category { margin-top: 20px; font-size: 0.95rem; color: #ffffff; font-weight: bold; border-left: 3px solid #c5a059; padding-left: 10px; }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 5px; border-bottom: 1px solid #222; }
        .label { font-size: 0.95rem; color: #bbbbbb; } 
        .val-container { text-align: right; }
        .value { font-size: 1rem; font-weight: 600; font-family: 'Roboto Mono', monospace; }
        .change { font-size: 0.8rem; margin-top: 2px; }
        .up { color: #ff4444; } .down { color: #4488ff; }
        #status { text-align: center; font-size: 0.7rem; color: #555; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="header" onclick="location.reload()">ğŸ“Š ì‹¤ì‹œê°„ ê²½ì œ ìƒí™©íŒ</div>

    <div class="category">ì™¸í™˜ / ì½”ì¸</div>
    <div id="section-fx">
        </div>

    <div class="category">ì¦ì‹œ / ì§€ìˆ˜ (ëŒ€ì²´)</div>
    <div id="section-stock">
        </div>

    <div id="status">ë°ì´í„° ì—°ê²° ì¤‘...</div>

    <script>
        const API_KEY = "7142915ec1dc45caad56dfc9fcf07341";

        // 1. ê°€ì ¸ì˜¬ í•­ëª© ì •ì˜
        const items = [
            { label: "ì›/ë‹¬ëŸ¬ í™˜ìœ¨", symbol: "USD/KRW", target: "section-fx" },
            { label: "ë¹„íŠ¸ì½”ì¸($)", symbol: "BTC/USD", target: "section-fx" },
            { label: "S&P 500 (ETF)", symbol: "SPY", target: "section-stock" },
            { label: "ë‚˜ìŠ¤ë‹¥ (ETF)", symbol: "QQQ", target: "section-stock" },
            { label: "ë¯¸ êµ­ì±„ 10ë…„", symbol: "TNX", target: "section-stock" }
        ];

        // 2. í™”ë©´ í‹€ ë¯¸ë¦¬ ë§Œë“¤ê¸°
        function init() {
            items.forEach(item => {
                const html = `
                    <div class="item-row">
                        <span class="label">${item.label}</span>
                        <div class="val-container">
                            <div class="value" id="val-${item.symbol}">--</div>
                            <div class="change" id="chg-${item.symbol}">--</div>
                        </div>
                    </div>`;
                document.getElementById(item.target).innerHTML += html;
            });
        }

        // 3. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (í•˜ë‚˜ì”© ìˆœì„œëŒ€ë¡œ)
        async function update() {
            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                try {
                    const res = await fetch(`https://api.twelvedata.com/quote?symbol=${item.symbol}&apikey=${API_KEY}`);
                    const data = await res.json();

                    if (data.close) {
                        const cur = parseFloat(data.close);
                        const prev = parseFloat(data.previous_close);
                        const diff = cur - prev;
                        const pct = ((diff / prev) * 100).toFixed(2);

                        // ê°’ ì—…ë°ì´íŠ¸
                        document.getElementById(`val-${item.symbol}`).innerText = cur.toLocaleString(undefined, {minimumFractionDigits: 2});
                        
                        // ë“±ë½ ì—…ë°ì´íŠ¸
                        const chgEl = document.getElementById(`chg-${item.symbol}`);
                        const sign = diff > 0 ? "â–²" : (diff < 0 ? "â–¼" : "");
                        chgEl.className = "change " + (diff > 0 ? "up" : "down");
                        chgEl.innerText = `${sign} ${Math.abs(diff).toFixed(2)} (${pct}%)`;
                    }
                } catch (e) {
                    console.log(item.symbol + " ì‹¤íŒ¨");
                }
                // ë¬´ë£Œ í‚¤ ì œí•œì„ í”¼í•´ 8ì´ˆ ëŒ€ê¸°
                document.getElementById('status').innerText = `ìˆ˜ì‹  ì¤‘ (${i+1}/${items.length})`;
                await new Promise(r => setTimeout(r, 8500));
            }
            document.getElementById('status').innerText = "ì—…ë°ì´íŠ¸ ì™„ë£Œ: " + new Date().toLocaleTimeString();
        }

        window.onload = () => {
            init();
            update();
        };
    </script>
</body>
</html>
